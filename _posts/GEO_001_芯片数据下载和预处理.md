---

layout:     post
title:      GEO芯片数据分析
subtitle:   001_数据下载和探针转换
date:       2022-08-17
author:     Iris
header-img: data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAsJCQcJCQcJCQkJCwkJCQkJCQsJCwsMCwsLDA0QDBEODQ4MEhkSJRodJR0ZHxwpKRYlNzU2GioyPi0pMBk7IRP/2wBDAQcICAsJCxULCxUsHRkdLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCz/wAARCAE7AOMDASIAAhEBAxEB/8QAGwAAAgMBAQEAAAAAAAAAAAAAAAECAwQFBgf/xAAzEAACAgEDAgUDAgYCAwEAAAAAAQIRIQMxQRJRBCJhcYETkbGhwQUUMlLR8ELhFSPxYv/EABgBAQEBAQEAAAAAAAAAAAAAAAABAgME/8QAFxEBAQEBAAAAAAAAAAAAAAAAABEBEv/aAAwDAQACEQMRAD8A+RgAFAAAAAAAAwAAAAoAAKCggGAAABQfIAAw7gADGURoKJtCSCIgT6QoCNWFFiiDi+QKwol00NLAKhTAn0gBQAARoAAAAAAAMQwAABBDAaAAABgAh0BQhghhCokrHX4JJJAFBRIkosqIKOw1EtUdmTUSilRsfR+S9aeSz6UqESsj0+Q+m17Gz6d8egfRfqIVj6F2A2/Tf9oCFcQAAw6AAAAABgIYAADSEMIBiGAxpCXBNFQqDpJ16BTKVGhkqFQQqZJJkoxLFFYQEUrWScYssUCyOm3wVEFFuixQbZdDTadPDLvpXWaZUqiMcpUXdEX8EowyqLYwdhlCOkty1aXoSUKRdpJ012LEZ/pLsBs+lICjwowA4vQQAADAQwgAaABLkYAtgAYAgGuCaVCXBJFRZGth0suyC9yXVSqllclQ0rzwS6VsRTVfktgm3jsioSVFsI7Nr1FS35LtPp2ab9y4JQinTrc0R06ewaUFaqzUo0layGd1Uo7dy5R8uVkthpqVXwXdEeP1LGWWOk27W25dDRTb9C7T085wu5e9Ldp+5RllCN0Thp9LtbPHuWLTd8mn6XSlSb/yBn6Pb7AaPp6mMfoAHzYAA4vQAAAgBhYwBAAwEMAAdDEhlQ1uMSGBJPHuO0yKJVVFRKO+S+LayihWXJ0iosd78N2aNFJ7lEZPbDVl8GqVbIqa2aadqv8A4aYuLxJbcozaav3xyatNJd7suML4qNL9i+ME0Z4t4S47M06ctkrKLYadcFnSqpDhGTq8u8E3HOVnsgKoRSdtXkuuN/rQON9TSV1eSKUn68cBFvl7P7gQ/wDZ2YAfLwAMnF6AFAMBUMAoBgAABIQyoAGAAiSQlRLAB2GIZUWRui2KKoMuXBU1JL0L44jl2vbJGFc5xyTVbfekVGjw816mzri0re26Rh0oq8GqEeHty+S4y1adSWLW1G3ThUL9aMUFUfKXR1NSMK3p8IqNsZSjStejfBbF07lv78GXTlGcW3l/YcJN12vngDcq25fccYSWNvUWnTq/j2NCjHddgivoh3/IE7XcAPkiGAHF6AAAADEPIACAAGNESSKhgkIlToBpb7AF0MB3gLyKxoolFMujuQiicW0VldFvbvtRdFqPPqzNyTXN7GkbITWHsaISdq2YNNttdka4v7rsRNbtOVZ4dWXfVbwtnsYYOSzx2NEFtnhmmWuMmk622depKLTks1m2VwVxf+5Gk0wOnpO0vY0ac0nT4MGjKot78l8JXl7BGhuFvP4AVw/tAK+UAAHF3AAAAADoBDoEiXBUISGPAAkSoLQWAwoYyoiOIySXYCcNidWVqy6JcQ0iSi37lkYYTJxhb4Kmnpxqn23ouimnfdC041fZlyivsGU9N9zRDjczJNP0NGm9smjW3STz3LfpxtttpvZFEJVW5oUrz+Qi/TUa3WUOEl1SXBCKynhNkmqaz7hF6ulv9wKvqP1AD5iMAOL0AOBDKAYkSCBBsNDeQExUSEAhoYABJERlEkSjvSIosVBEkTi9ipMtTTrBUaFLCat0Www7M6mk0tki6ElTV5KzrRGXPBKN36FUZcF8c4+QixPHcnFrGxVFv4JqnVGkb9Ounvf3LepJKjLpycV3ssUlKgNsZqn2B6l4Rni9ld9xt23fAFnUwIpRpeYAPngDA4u4GiI0UMYJDpBAMAQAFEgKItAuCdCphCrkZLgQAkTSbBJvBYk1wURVq0SQ2giENE4vIsElWCoug7S9DVp5WTLpqS9v8mlTpLDCatS2d4LIvO2ChaidF0XtRcRensWxdPt3KVis45sb1e1ehUaIzTvv+pdFpr/JiepTXf7WXKalHHPAF9P+4DP9RrkAPD0x0PI0jk7IcjonSyKgBDEMBjX6Cpsml6FQdP5BL3JdPJJx7WURp/oRplvC+wqTyQQX6k1FgTVlQRjhjXG400lklSaTssCklRXhfktlsl75K3Fqn6E1Am3RZFlKZZFt8gaYTV/BbbfyjPpx55NEEluVNWRSVfqaIySRmUlY/qLDfAqNDk38Ebba9MkFK+RxkrqxROpStvYsWo0q4sUemnmvQhOUd7oos62BV9RegBHlyVkR5ObskAhgMKAfSyoFaJq7IpOyyKAsirJUKFlqV49C4ilr9CKSrHzRfOCqkVqNYQEUicVgCVUgI9LFsTT3B54yVCtvA2txx07ySlGtvkChxdslCMm6B7ji2nh9yDUqjx8jbtYefQo8zW74LoJLO+PsUhp2lx/vJOTSiqz+5Wqv0JNpYtBDU6vHwhPVd4XyKWlrzh1Rj5c+7rsUxhNYkmr2tNYA0fXfouWReq5Wt84KvpuT6Y/PxkhObScY2qz6vuCL+v8A2wMn1JgFjnjQhow2kMFQyoEiQkWJICKLEngjFPL9S6KwVDiuPyTpojWyLE1j8FQ6efbBCUGndF6fccoxy0vsBjvI3LDRbLTSTexRTvuAK7snGMnsn6DWnVNv/JohFWkvkB6elPptqlWy5ohPqavpb4fY1vGmlnPJCCilJPPqErn4ssjFN39iWpovrfSq2LYaMopBaShJukrrkk4uGO/Y0RTqsZI1KU1GKt8JBKyryuW+bpMJN496fojfLwGu49TlGOMJW2YdRSjJwkqkt72ruUrt6Gl1wjJpqKrpS3ardkPHaOhqRguqMJqVrGKHo66lDT0dHLi4dclwqqjVPwkNVRcup0qb/wAFZefenr6MpVGT56o7fALS0daMpaknHUfbCXuelj4RdC05LyRV+arqjm+J8DDVUumLXS66lvT/AEJFrj/yOp/fH7MC5/w3xibS1Y0sLL2AkWuECCiSRh0NNEiNDVlRNYJ4dFaJK+2AJrHctjwVq7RohF0VEKfdDp4rJLoeb4JxWPZlQ4p0r9C1qkvYjjBPHwl/tBFbVrOxTqYrpSp9zS11cdirp6pdFZ7gqGnC6ts36Gls69+5RDQaabk23xRs0u1ZXbsU3Tlo3gr1EoxUVVr/AHJv6U4+qX3Mc9OUm8ezQjLLvK2u2e5oio49cFS06u1eXuXRpL8EU3FK6xjBZoRjB9VXKeFfYUF14bV43Oh4fwUpxi+rKrfZLsjSI6UJ68nDaTrL/wCNFep/Co6k11ScnC43l+tYOxDwrhcqjtTf/JlunpaablGLtKwOd4bwq0I9K01l3UVV8Js3w+muGtkm+A1HFU6W6xy3e1CjBdcZNOm26lsvYIq14Q/qi3d2uz+Njn6vV1eVVa2vD9zr6i6qTWdmijU0NJK6uT3VvAVyc9pfC/6A3NaVvMQA+fIaEiVI5up0NRvkS4JJsCSSRNJEUSRUSSa9S2LbVZ+CMEnb2LU3EqJbpfuO+wLf3Y6QDjSVsippya/UTwUPqu0vkDUnUXW7e18FsE8eWu5ToJuupYs6EOlVjHIZ1KGli3vwWqMUsY/cE1x9hSnUljBpEpzqLa3XBnc3TpMvc4yxRX5FaT9dv0Ap3dNZNEIwlSjG5Y2XIPRcknCrfsdX+GaMYafXNU7+QKvD+BcqlOGU/g7vhtBqC8sUtqSX7D0oqUXjy32ybdOKxSwtiCqelBqudrS/YolDpUVG9+Fg3uDbbZTOMIUnnvsBlelGSz73z8FE4fSXU5XWyNlxyk1VKkUS0Z6ssZxdL0GDIlb6926xvRs0PC/XTjN0m6bqrXozT4fwLkqnGo9+bOpHQhGKikqW3oKuYwL+H+ESSWjpUsLyLYDpY9fsgJdWPgpJURRJNGWzJJZzdBaexJfAElS2JKiMab4v8E0s1tkqJqXoWLqk3jbuKEJRd4a9MlvWqSr9SojGecRfyWZfDyEHC269mXRS3bzwq2CVncNTN1X3oI6Lw8+l/uaVm6V9+6LtLQlO9+7YKr0oPCpfY1RhJtWnVWy3T8Pyv+zVDRUY1s0tvcrLGoyeywn8k/ouUXaav4z6GuGll3x2LXp4/BRyZaM1VJposho9UVayje9N5tFM30Lal+wENLTnGUWotq8pLB6DwcIRik6pU0n3ZxdBTm6TbV2u7O3p6MpR089tsPHcDcumSxXsXw7FUNOKVrdUWRlTqtjIsmqir5MetJdLdei9zRqTeL24M2qnqeXZJ37jBiUm35W3K/LFYOl4GL6fNFqTy0ZoacNPUimlc5NKXbGxu0+uE+lxSXDso6EIpJUvYG0tyh6jWzwU6vilD+prs8karV9RdgOd/N6XdfcAlfFk0TVEEnzRJV3MuqxV8EklZVfqSuTCLGqJxeKxXyVppVfBK4blRap9NpZ73kfU3/uSpSSTVklJUt7rYo26MINZf2L6x5ZLevc5sHOTbTqt3ZOMtZpt365YSOrBUrtJvevU1aHS1VtNHF09XU/p836s6Xh5N0m8PmuSs662k12viyfQm/ngr0I4Wd2afJHn0KhUo1S9/ctd07S9+xDHmuqw/UuUE4prcIpcbunWKM2rBNxWWkkm3tZrnHZWv3KsZjLnZ9kFaPC6cIKLXosHY0sJYRyfD6fTJZ8vB0Y6iWFwiDXGe/qRnKvUp63veNwtyzbX7kFnUpqqrt3GopJCXSk6KdSc0k4uq3AulG6ayk7SL4aqaWc7ZMUPEUql/VzRL60bTTV8iC3U1JJSp75OF4zxTh1OT8zbvJ1dSXUpU8pWjzP8T09brlJ5vPlKI/8AkX/f+QOU5u35QFI86GBU+WCS7nN2SqHLfwNKOybFSQ7Xb8gOnx+UPzcpCT9vsgcnmioknJD6pbpsrsdgi6GtKN5fwiX1n6v32M9saaxdrJSN2g/6nbXVR2dD6coqS3pL1s4/htLqqcurpbSlaeF6HSgo6XTT8uIlxz10dGc6cVajdl9uuW+DPpaiTpNXgt+rGNptd1/0aRepTXU+m+yr4sshr9KSk77GRa6ccN9XrsRc06t2v9wBsnrL5fbcp60767Zn+tG2r2z6lGprtSlUls229ktwO1oa0cJ0qrnc2xnFtPlnk4eP1k+luLzawal42bju3LinsB6Z6kVFu/8AURjr1V7ZxZ57+c1nCKnPzJbRxeSvT/ibXXGTcqdPbAHqf5iPD7lOtObrpr1OJp+Pirm2+m22mncV7Cf8W0JtKGtHzWku/wByDqPXjB1bummzLPxnHV0rN5Odr+Kdyd00ndvY5mp4zTclUraw+z+Sj1mj4yM4pKVtp8mbxUeu2pO2sXxfBw/D+NgpU204tPfY6MfFabT6mtup28JAY34fUt459QLPrx4lCuMgQrxtLuPyrkKE0jm7JWu7D5I+VDVbZsB/IxXW4YfIEsd0GO4qD5KJX7/sS0mlOLksJ2VY7k4xcmmmlXO1hHXjqRcVlXskv8FktXphiPU0m1vx7mHQa07k5Xh43L9TxC6KSTbTUlnY0xF2h4rUx1PzN5TxSNL1ZPMmqxXFe5x1qdKTjeOHsTl4mfTVqn+nwKR2o6qcGru0qtIrc5RacZ731I4P8zqxeJSV9mS/nNVqm3xbt8CkddTn1yallblHifELCw85OdHxk4tuOHu/VinrqSul1PPu+4qxph4jUUm4q72to06WtLDbXrnZnJTtuUnfoOWu0vK98XW3sSkbNbx1T1YJtu2k+PhGSXitW7jLpd23dtv1M7bbtu2RfJN1qNkfG+IrOrJ3i06xzsVvWl3wm6+TOIlWNi8f4iK6cNcXn8lUvETk7aV//l0Zxikxpj4hxkm79R6vjdbUSjb6Vnt+DKBaRtXilSw9l/yYGGwJU5SfrYDf7j5+QpVkeV2Em7ed0Nt+YAtB5sf4Issj+wEc3kbe62d0N/sL+4IFXYsg8usVx/8AStpfoPZKuxRqWpCNXh4dd0KU4Sbp7bPBkt9wTbbbdt5z3AuulOtrxl9yLk3h1XsQm3SyPUSX06xejCT9W08gDp/BHpe6ee2wl+4MipXLsHV3KwAlb7iu6IjWwpAFiGssKQD7iIAYCAAH29hAAAAH/9k=
catalog: true
tags:
    - 生信
    - GEO芯片数据

---

# 设置环境

```r
getwd() # 确认所在路径
setwd() # 修改路径
rm(list = ls())  # 一键清空已有变量
options(stringsAsFactors = F)# 在调用as.data.frame的时，将stringsAsFactors设置为FALSE可以避免character类型自动转化为factor类型
```

# 下载数据

```r
library(GEOquery)

gset <- getGEO('GSE42872', 
               destdir=".",
               AnnotGPL = F,     ## 注释文件
               getGPL = F)       ## 平台文件

gset # 查看数据信息
```

![gset信息](https://github.com/iriswang1995/iriswang1995.github.io/blob/master/img-post/GEO_001/a48d696e749a3b198437b2278e9f47d2.png?raw=true)

```r
dat <- exprs(gset[[1]]) # 获取表达矩阵

dat[1:5,1:5] # 查看表达矩阵，前5行，前5列
```

![](https://github.com/iriswang1995/iriswang1995.github.io/blob/master/img-post/GEO_001/b219283810ac73d95a5b91b2adb62f00.png?raw=true)

# 获取临床数据

```r
pd <- pData(gset[[1]])
# 挑选感兴趣的临床数据
library(stringr)
group_list <- str_split(pd$title,' ',simplify = T)[,4]
table(group_list)
```

![分组信息](https://github.com/iriswang1995/iriswang1995.github.io/blob/master/img-post/GEO_001/58d14e2f3c7b16d1bc2f1514a6c7a7ba.png?raw=true)

# 获取平台数据

```r
# 下载平台数据，也可以去GEO网页手动下载
gpl <- getGEO('GPL6244', destdir=".")
head(Table(gpl)[2,c(1,10)]) # 查看GPL第2行的1和10列，发现gene symb藏在gene_assignment中间，被"//"隔开
```

![](https://github.com/iriswang1995/iriswang1995.github.io/blob/master/img-post/GEO_001/a48e944f9662eed3f7bbec3e934a383c.png?raw=true)

```r
probe2gene=Table(gpl)[,c(1,10)] # 取出GPL的1和10列，现在需要将gene symbol取出来

library(dplyr)
library(tidyr) 
probe2gene <- probe2gene %>%
  # 用separate()函数分割gene_assignment，只给了两个列名，即只留下前两列
  separate(gene_assignment, into = c("drop", "symbol"), sep = "//") %>%
  # 删除drop
  select(-drop) %>%
  # 删除symbol为空的行
  filter(symbol != "")

head(probe2gene) # 查看probe2gene
save(probe2gene,file='probe2gene.Rdata') # 保存数据
```

![](https://github.com/iriswang1995/iriswang1995.github.io/blob/master/img-post/GEO_001/c8536ee4292722b239e7e6e7b2fe93b5.png?raw=true)

# 转换表达矩阵的探针名

```r
probe2gene$ID <- as.character(probe2gene$ID) # 将probe2gene$ID转换为字符串，不然可能会报错

library(tibble)
dat <- dat %>%
  # 将dat的行名变成列，注意要与probe2gene的探针列名相同
  rownames_to_column("ID") %>% 
  # 合并dat和probe2gene
  inner_join(probe2gene) %>%
  # 删除ID
  dplyr::select(-ID) %>%
  # 将symbol提到第一列
  dplyr::select(symbol,everything()) %>%
  # 由于symb可能有重复，所以需要去重，这里选择表达量最高的一个
  # 生成新的一列，数值是每行的平均值
  mutate(rowMean = rowMeans(.[,-1])) %>%
  # 按照rowMean从大到小的顺序重新排序
  arrange(desc(rowMean)) %>%
  # 当遇到重复的symbol时，选择第一个
  distinct(symbol, .keep_all = T) %>%
  # 删除rowMean
  dplyr::select(-rowMean) %>%
  # symbol转为行名
  column_to_rownames("symbol")

head(dat) # 查看dat

save(dat,group_list,file = 'step1-output.Rdata') # 保存数据
```

![最终结果](https://github.com/iriswang1995/iriswang1995.github.io/blob/master/img-post/GEO_001/070fbb76e4e338ed067d21f85e97ca25.png?raw=true)

**最后生成行名是gene symbol，列名是样本的数据框**
